<!DOCTYPE html>
<html>
<head>
  <title>TodoMVC sideways</title>
  <style>
  body {
    margin: none;
    padding: none;
  }
  #app {
    margin: 20px 50px;
    width: 300px;
    height: 300px;
    border: 1px solid black;
    transform: translateY(100px) perspective( 300px ) rotateY( -35deg );
  }
  svg {
    z-index: -1;
  }
  #controls {
    width: 250px;
    margin: 0 auto;
  }
  #counter {
    margin-left: 200px;
  }
  button {
    padding: 20px;
    font-size: large;
    margin: 20px;
  }
  </style>
  <script src="node_modules/rx/dist/rx.all.js"></script>
  <script src="node_modules/@cycle/core/dist/cycle.js"></script>
  <script src="node_modules/@cycle/dom/dist/cycle-dom.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
  <script src="connection.js"></script>
</head>
<body>
  <div id="app"></div>

  <script>
    function main(sources) {
      // intent
      const decrement$ = sources.DOM
        .select('#minus').events('click')
        .map(ev => -1);

      const increment$ = sources.DOM
        .select('#plus').events('click')
        .map(ev => +1);

      const action$ = Rx.Observable.merge(decrement$, increment$);
      // model
      const count$ = action$.startWith(0).scan((x,y) => x+y);

      // view
      const vtree$ = count$.map(count =>
        CycleDOM.div([
          CycleDOM.button('#minus', 'Decrement'),
          CycleDOM.button('#plus', 'Increment'),
          CycleDOM.p('#counter', 'Counter: ' + count)
        ])
      );
      return { DOM: vtree$ };
    }

    Cycle.run(main, { DOM: CycleDOM.makeDOMDriver('#app') });


    setTimeout(function () {
      // drawing code
      var w = window,
      d = document,
      e = d.documentElement,
      g = d.getElementsByTagName('body')[0],
      x = w.innerWidth || e.clientWidth || g.clientWidth,
      y = w.innerHeight|| e.clientHeight|| g.clientHeight;

      // Creates canvas 320 Ã— 200 at 10, 50
      var paper = Raphael(0, 0, x, y);

      // Creates circle at x = 50, y = 40, with radius 10
      var circle = paper.circle(50, 40, 10);

      // Sets the fill attribute of the circle to red (#f00)
      circle.attr("fill", "#f00");

      var decClicks = paper.rect(400, 150, 100, 50)
      decClicks.attr('fill', '#ffe')
      decClicks.attr('stroke', '#f00')
      var decClicksText = paper.text(450, 175)
      decClicksText.attr({ text: 'map\nev => -1', 'font-size': '12px' })
      var decrementsText = paper.text(550, 160)
      decrementsText.attr({ text: 'decrements$', 'font-size': '15px' })

      var incClicks = paper.rect(400, 250, 100, 50)
      incClicks.attr('fill', '#ffe')
      incClicks.attr('stroke', '#f00')
      var incClicksText = paper.text(450, 275)
      incClicksText.attr({ text: 'map\nev => +1', 'font-size': '15px' })
      var incrementsText = paper.text(550, 285)
      incrementsText.attr({ text: 'increments$', 'font-size': '15px' })

      var actions = paper.rect(600, 200, 100, 50)
      actions.attr('fill', '#ffe')
      actions.attr('stroke', '#f00')
      var actionsText = paper.text(650, 225)
      actionsText.attr({ text: 'merge', 'font-size': '15px' })
      var actions$Text = paper.text(690, 260)
      actions$Text.attr({ text: 'actions$', 'font-size': '15px' })

      // paper.connection(circle, circle2, '#00f')
      // animating movement along path is based on
      // http://jsfiddle.net/gyeSf/17/
      var c1 = paper.connection(document.querySelector('#minus'), decClicks, '#333')
      var c2 = paper.connection(document.querySelector('#plus'), incClicks, '#333')

      var c3 = paper.connection(decClicks, actions, '#333')
      var c4 = paper.connection(incClicks, actions, '#333')

      // model
      var scan = paper.rect(600, 350, 100, 50)
      scan.attr('fill', '#ffe')
      scan.attr('stroke', '#0f0')
      var scanText = paper.text(650, 375)
      scanText.attr({ text: 'scan\n(x,y) => x+y', 'font-size': '15px' })
      var count$Text = paper.text(690, 410)
      count$Text.attr({ text: 'count$', 'font-size': '15px' })

      var c5 = paper.connection(actions, scan, '#333')

      // view
      var vtree = paper.rect(450, 550, 340, 150)
      vtree.attr('fill', '#ffe')
      vtree.attr('stroke', '#00f')
      var vtreeText = paper.text(460, 625)
      vtreeText.attr({
        text: 'map\ncount => div([\n' +
          '  button(\'#minus\', \'Decrement\'),\n' +
          '  button(\'#plus\', \'Increment\'),\n' +
          '  p(\'#counter\', \'Counter: \' + count)\n' +
          '])',
        'font-size': '15px',
        'font-family': 'monospace',
        'white-space': 'pre',
        'text-anchor': 'start'
      })
      var vtree$Text = paper.text(420, 635)
      vtree$Text.attr({ text: 'vtree$', 'font-size': '15px' })

      var c6 = paper.connection(scan, vtree, '#333')

      var c7 = paper.connection(vtree, document.querySelector('#app'), '#333')

      var n = c1.line.getTotalLength()
      console.log(n)
      var pos = c1.line.getPointAtLength(0)
      circle.attr({cx: pos.x, cy: pos.y})
    }, 0);
  </script>
</body>
</html>
